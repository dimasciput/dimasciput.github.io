function addClass(e,t){e.className+=" "+t}function removeClass(e,t){for(var a=" "+e.className+" ";-1!==a.indexOf(" "+t+" ");)a=a.replace(" "+t+" ","");e.className=a}function isCanvas(e){return e instanceof HTMLCanvasElement}const createChart=(e,t)=>{document.getElementById(e).innerHTML="";let a=[],n=[],o=[];if(t.hasOwnProperty("service_registry_values")&&(a=t.service_registry_values),0===a.length)return;for(let e=0;e<a.length;e++)try{if(!a[e].value)continue;o.push(parseFloat(a[e].value)),n.push(e+1)}catch(e){console.log(e)}new Chartist.Line(`#${e}`,{labels:n,series:[o]},{height:250,showPoint:!1,lineSmooth:!1,axisX:{showGrid:!0,showLabel:!0}})},createRaw=(e,t)=>{let a=document.getElementById(e);a.innerHTML="",a.innerHTML=JSON.stringify(t,null,1)},createTable=(e,t)=>{let a=document.getElementById(e);a.innerHTML="";let n=[];if(t.hasOwnProperty("service_registry_values")&&(n=t.service_registry_values),0!==n.length)for(let e=0;e<n.length;e++)try{const t=n[e].name;let o=n[e].value,l=parseFloat(o);isNaN(l)||(o=l.toFixed(3));let s=document.createElement("div");addClass(s,"row");let r=document.createElement("div");addClass(r,"col-sm-8"),addClass(r,"geocontext-table-name"),r.innerHTML=t,s.appendChild(r);let i=document.createElement("div");addClass(i,"col-sm-4"),addClass(i,"geocontext-table-value"),i.innerHTML=o,s.appendChild(i),a.appendChild(s)}catch(e){console.log(e)}};!function(){let e=document.getElementById("lat"),t=document.getElementById("lon"),a=document.getElementById("fetch-button"),n=document.getElementsByClassName("geocontext-container")[0],o=document.getElementsByClassName("loading-container")[0],l=document.getElementById("geocontext-group-select"),s=document.getElementsByClassName("response-time")[0],r="",i=null,c=null,d="https://a.tiles.mapbox.com/v2/aj.1x1-degrees.json";mapTileKey&&(d="https://api.maptiler.com/maps/streets/256/tiles.json?key="+mapTileKey);let u=new XMLHttpRequest;u.onload=function(){if(200===u.status){c=(new Date).getTime(),o.style.display="none";const e=JSON.parse(u.responseText);if(s.innerHTML=`Response time : ${c-i} ms`,s.style.display="block",n.style.display="block",u.responseText.indexOf("monthly")>-1)createChart("tab3",e);else{let e=document.getElementById("tab3"),t=e.parentNode;e.remove(),addClass(e=document.createElement("div"),"tab-content"),e.dataset.chart="true",t.appendChild(e),e.id="tab3",e.innerHTML='<div class="error">Data cannot be used for a chart.</div>'}createRaw("geocontext-data",e),createTable("geocontext-table",e),a.disabled=!1}else o.style.display="none",a.disabled=!1,alert("Request failed.  Returned status of "+u.status)};const m=new ol.Map({layers:[new ol.layer.Tile({source:new ol.source.TileJSON({url:d,crossOrigin:"anonymous"})})],target:"map",view:new ol.View({center:[0,0],zoom:2})});let p=null;const y=(e,t=!1)=>{if(!p){(p=new ol.Feature({geometry:new ol.geom.Point([0,0])})).setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,135],anchorXUnits:"fraction",anchorYUnits:"pixels",scale:.3,src:"static/location-pointer.png"})}));let e=new ol.layer.Vector({source:new ol.source.Vector({features:[p]})});m.addLayer(e)}p.getGeometry().setCoordinates(e),t&&m.getView().animate({center:e,zoom:5,duration:300})},g=new Geocoder("nominatim",{provider:"osm",lang:"en",placeholder:"Search for ...",limit:5,debug:!1,autoComplete:!0,keepOpen:!0,preventDefault:!0});m.addControl(g);let v=a=>{let n=t.value,o=e.value;if(n&&o){let e=ol.proj.transform([n,o],"EPSG:4326","EPSG:3857");y(e,!0)}},f=e=>{13===e.keyCode&&v()};e.addEventListener("focusout",v),t.addEventListener("focusout",v),e.addEventListener("keyup",f),t.addEventListener("keyup",f),t.value=23.55,e.value=-30.55,v(),g.on("addresschosen",function(a){a.bbox?m.getView().fit(a.bbox,{duration:500}):m.getView().animate({zoom:14,center:a.coordinate}),window.setTimeout(function(){let n=ol.proj.transform(a.coordinate,"EPSG:3857","EPSG:4326");t.value=n[0].toFixed(4),e.value=n[1].toFixed(4),y(a.coordinate)},500)}),m.on("click",function(a){let n=ol.proj.transform(a.coordinate,"EPSG:3857","EPSG:4326");t.value=n[0].toFixed(4),e.value=n[1].toFixed(4),y(a.coordinate)}),a.addEventListener("click",function(){this.disabled=!0,o.style.display="block",n.style.display="none",s.style.display="none";let a=t.value,c=e.value;r=l.querySelector(".selected").dataset.value,i=(new Date).getTime(),u.open("GET",`https://geocontext.kartoza.com/api/v1/geocontext/value/group/${a}/${c}/${r}`),u.send()});const h=e=>{const t=e.target.getAttribute("data-for"),a=document.getElementById(t),n=a.parentElement.querySelectorAll(".active");[].forEach.call(n,function(e){e.classList.remove("active")}),[].forEach.call(e.target.parentElement.querySelectorAll(".active"),function(e){e.classList.remove("active")}),addClass(e.target,"active"),addClass(a,"active"),"true"===a.dataset.chart&&void 0!==a.__chartist__&&a.__chartist__.update()};Array.from(document.getElementsByClassName("tab-option")).forEach(function(e){e.addEventListener("click",h)})}();
