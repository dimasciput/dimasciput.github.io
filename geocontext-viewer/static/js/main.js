!function(){let e=document.getElementById("lat"),t=document.getElementById("lon"),n=document.getElementById("fetch-button"),o=document.getElementById("geocontext-data"),l=document.getElementsByClassName("loading-container")[0],s=document.getElementById("geocontext-group-select"),a=document.getElementsByClassName("response-time")[0],i="",r=null,d=null,c="https://a.tiles.mapbox.com/v2/aj.1x1-degrees.json";mapTileKey&&(c="https://api.maptiler.com/maps/streets/256/tiles.json?key="+mapTileKey);let u=new XMLHttpRequest;u.onload=function(){if(200===u.status){d=(new Date).getTime(),l.style.display="none";let e=JSON.parse(u.responseText);a.innerHTML=`Response time : ${d-r} ms`,a.style.display="block",o.innerHTML=JSON.stringify(e,null,1),o.style.display="block",n.disabled=!1}else l.style.display="none",n.disabled=!1,alert("Request failed.  Returned status of "+u.status)};let m=new ol.Map({layers:[new ol.layer.Tile({source:new ol.source.TileJSON({url:c,crossOrigin:"anonymous"})})],target:"map",view:new ol.View({center:[0,0],zoom:2})}),y=null,p=(e,t=!1)=>{if(!y){(y=new ol.Feature({geometry:new ol.geom.Point([0,0])})).setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,135],anchorXUnits:"fraction",anchorYUnits:"pixels",scale:.3,src:"static/location-pointer.png"})}));let e=new ol.layer.Vector({source:new ol.source.Vector({features:[y]})});m.addLayer(e)}y.getGeometry().setCoordinates(e),t&&m.getView().animate({center:e,zoom:5,duration:300})},g=n=>{let o=t.value,l=e.value;if(o&&l){let e=ol.proj.transform([o,l],"EPSG:4326","EPSG:3857");p(e,!0)}},v=e=>{13===e.keyCode&&g()};e.addEventListener("focusout",g),t.addEventListener("focusout",g),e.addEventListener("keyup",v),t.addEventListener("keyup",v),t.value=23.55,e.value=-30.55,g(),m.on("singleclick",function(n){let o=ol.proj.transform(n.coordinate,"EPSG:3857","EPSG:4326");t.value=o[0].toFixed(4),e.value=o[1].toFixed(4),p(n.coordinate)}),n.addEventListener("click",function(){this.disabled=!0,l.style.display="block",o.style.display="none",a.style.display="none";let n=t.value,d=e.value;i=s.querySelector(".selected").dataset.value,r=(new Date).getTime(),u.open("GET",`https://geocontext.kartoza.com/api/v1/geocontext/value/group/${n}/${d}/${i}`),u.send()})}();
