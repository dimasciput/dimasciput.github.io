!function(){let e=document.getElementById("lat"),t=document.getElementById("lon"),o=document.getElementById("fetch-button"),n=document.getElementById("geocontext-data"),l=document.getElementsByClassName("loading-container")[0],a=document.getElementById("geocontext-group-select"),s=document.getElementsByClassName("response-time")[0],i="",r=null,d=null,c="https://a.tiles.mapbox.com/v2/aj.1x1-degrees.json";mapTileKey&&(c="https://api.maptiler.com/maps/streets/256/tiles.json?key="+mapTileKey);let u=new XMLHttpRequest;u.onload=function(){if(200===u.status){d=(new Date).getTime(),l.style.display="none";let e=JSON.parse(u.responseText);s.innerHTML=`Response time : ${d-r} ms`,s.style.display="block",n.innerHTML=JSON.stringify(e,null,1),n.style.display="block",o.disabled=!1}else l.style.display="none",o.disabled=!1,alert("Request failed.  Returned status of "+u.status)};const m=new ol.Map({layers:[new ol.layer.Tile({source:new ol.source.TileJSON({url:c,crossOrigin:"anonymous"})})],target:"map",view:new ol.View({center:[0,0],zoom:2})});let p=null;const y=(e,t=!1)=>{if(!p){(p=new ol.Feature({geometry:new ol.geom.Point([0,0])})).setStyle(new ol.style.Style({image:new ol.style.Icon({anchor:[.5,135],anchorXUnits:"fraction",anchorYUnits:"pixels",scale:.3,src:"static/location-pointer.png"})}));let e=new ol.layer.Vector({source:new ol.source.Vector({features:[p]})});m.addLayer(e)}p.getGeometry().setCoordinates(e),t&&m.getView().animate({center:e,zoom:5,duration:300})},g=new Geocoder("nominatim",{provider:"osm",lang:"en",placeholder:"Search for ...",limit:5,debug:!1,autoComplete:!0,keepOpen:!0,preventDefault:!0});m.addControl(g);let f=o=>{let n=t.value,l=e.value;if(n&&l){let e=ol.proj.transform([n,l],"EPSG:4326","EPSG:3857");y(e,!0)}},v=e=>{13===e.keyCode&&f()};e.addEventListener("focusout",f),t.addEventListener("focusout",f),e.addEventListener("keyup",v),t.addEventListener("keyup",v),t.value=23.55,e.value=-30.55,f(),g.on("addresschosen",function(o){o.bbox?m.getView().fit(o.bbox,{duration:500}):m.getView().animate({zoom:14,center:o.coordinate}),window.setTimeout(function(){let n=ol.proj.transform(o.coordinate,"EPSG:3857","EPSG:4326");t.value=n[0].toFixed(4),e.value=n[1].toFixed(4),y(o.coordinate)},500)}),m.on("click",function(o){let n=ol.proj.transform(o.coordinate,"EPSG:3857","EPSG:4326");t.value=n[0].toFixed(4),e.value=n[1].toFixed(4),y(o.coordinate)}),o.addEventListener("click",function(){this.disabled=!0,l.style.display="block",n.style.display="none",s.style.display="none";let o=t.value,d=e.value;i=a.querySelector(".selected").dataset.value,r=(new Date).getTime(),u.open("GET",`https://geocontext.kartoza.com/api/v1/geocontext/value/group/${o}/${d}/${i}`),u.send()})}();